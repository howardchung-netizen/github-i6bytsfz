# 本地測試步驟 - 遷移到 2.0 Flash

## 🚀 快速測試流程

### 步驟 1: 啟動開發服務器

```bash
npm run dev
```

等待看到：
```
✓ Ready in X seconds
○ Local:        http://localhost:3000
```

---

### 步驟 2: 測試 API 端點（最直接的方法）

**在瀏覽器中打開**：
```
http://localhost:3000/api/test-google-api
```

**預期結果**：
```json
{
  "success": true,
  "message": "Google API 連線成功！",
  "response": "測試成功",
  ...
}
```

**如果看到錯誤**：
- 檢查 `.env.local` 文件是否存在 `GOOGLE_GEMINI_API_KEY`
- 確認 API Key 是否有效
- 檢查 Console 是否有錯誤訊息

---

### 步驟 3: 登入應用程式

1. **打開瀏覽器**：`http://localhost:3000`
2. **登入帳號**：
   - 使用現有帳號，或
   - 註冊新帳號

---

### 步驟 4: 測試題目生成功能

#### 方法 A: 從首頁開始練習（推薦）

1. **進入首頁（Dashboard）**
   - 登入後應該自動進入 Dashboard

2. **點擊「開始練習」或「練習」按鈕**
   - 會進入「選擇單元」頁面

3. **選擇一個數學單元**
   - 例如：選擇「除法」或「周界」
   - 可以選擇多個單元

4. **點擊「開始練習」按鈕**
   - 按鈕會顯示選中的單元數量，例如：「開始練習 (1)」

5. **觀察題目生成過程**：
   - 應該看到「題目生成中...」的載入畫面
   - 等待幾秒鐘（通常 3-10 秒）
   - 題目生成成功後會顯示題目內容

#### 方法 B: 從開發者模式測試（如果可用）

1. **進入開發者模式**
   - 如果您的帳號是 `admin@test.com`，應該有開發者選項

2. **使用「AI 生成測試台」**
   - 貼上一個種子題目 JSON
   - 點擊「生成題目」按鈕
   - 觀察生成結果

---

### 步驟 5: 驗證模型是否正確切換

#### 5.1 檢查瀏覽器 Console

1. **打開開發者工具**：
   - 按 `F12` 或 `Ctrl+Shift+I` (Windows)
   - 或 `Cmd+Option+I` (Mac)

2. **切換到 Console 標籤**

3. **生成題目時觀察日誌**：
   - 應該看到：`🚀 Calling Next.js API Route (/api/chat)...`
   - 應該看到：`🌱 Seed Found for Context: ...`
   - **不應該**看到錯誤訊息

#### 5.2 檢查 Network 請求

1. **打開開發者工具 → Network 標籤**

2. **生成題目時觀察請求**：
   - 找到 `/api/chat` 請求
   - 點擊該請求

3. **檢查 Request Payload**：
   - 查看發送的 prompt 內容
   - 確認請求格式正確

4. **檢查 Response**：
   - 確認返回的 JSON 格式正確
   - 確認題目內容正常

#### 5.3 驗證 API 實際調用的模型

**方法 1: 檢查 Network 請求**

1. 在 Network 標籤中找到 `/api/chat` 請求
2. 查看該請求的詳細信息
3. 雖然看不到直接調用的 Google API，但可以確認：
   - 請求成功（Status 200）
   - 返回了有效的 JSON 響應

**方法 2: 檢查服務器日誌**

在終端（運行 `npm run dev` 的窗口）中：
- 應該看到 API 調用的日誌
- 如果有錯誤，會顯示在終端

**方法 3: 直接測試 API 端點**

訪問：
```
http://localhost:3000/api/test-google-api
```

如果返回成功，說明：
- ✅ API Key 正確
- ✅ 可以連接到 Google API
- ✅ 模型配置正確（因為代碼已更新）

---

### 步驟 6: 檢查是否有錯誤

#### 6.1 常見錯誤及解決方法

**錯誤 1: "API Key not configured"**
- **原因**: `.env.local` 文件不存在或缺少 `GOOGLE_GEMINI_API_KEY`
- **解決**: 創建 `.env.local` 文件，添加：
  ```
  GOOGLE_GEMINI_API_KEY=your_api_key_here
  ```
- **注意**: 需要重啟 `npm run dev` 才能讀取新的環境變數

**錯誤 2: "Model not found" 或 "404"**
- **原因**: 模型名稱錯誤或 API Key 沒有權限
- **解決**: 
  1. 確認 `app/lib/constants.js` 中的模型名稱是 `gemini-2.0-flash-exp`
  2. 檢查 Google AI Studio 確認 API Key 有權限

**錯誤 3: "Quota exceeded"**
- **原因**: API 配額已用完
- **解決**: 
  1. 等待配額重置（每天香港時間下午 4:00）
  2. 或升級到付費方案

**錯誤 4: 題目生成失敗或返回錯誤格式**
- **原因**: 可能是 prompt 格式問題或模型響應異常
- **解決**: 
  1. 檢查 Console 中的錯誤訊息
  2. 檢查 Network 中的 API 響應
  3. 確認返回的 JSON 格式正確

---

### 步驟 7: 驗證功能完整性

#### 7.1 測試題目生成
- [ ] 題目成功生成
- [ ] 題目內容合理（不是亂碼或錯誤）
- [ ] 題目格式正確（有選項、答案、解釋）

#### 7.2 測試題目回答
- [ ] 可以選擇答案
- [ ] 點擊「檢查答案」後顯示正確/錯誤
- [ ] 顯示解釋內容

#### 7.3 測試下一題功能
- [ ] 點擊「下一題」可以生成新題目
- [ ] 新題目內容不同於上一題
- [ ] 不會出現重複題目

---

## ✅ 測試成功標準

如果以下所有項目都正常，說明遷移成功：

1. ✅ `/api/test-google-api` 返回成功
2. ✅ 可以成功生成題目
3. ✅ 題目內容格式正確
4. ✅ 沒有 Console 錯誤
5. ✅ Network 請求都成功（Status 200）
6. ✅ 題目回答功能正常

---

## 🔍 如何確認使用的是 2.0 Flash？

### 方法 1: 檢查代碼（最可靠）

確認 `app/lib/constants.js` 中：
```javascript
export const CURRENT_MODEL_NAME = "gemini-2.0-flash-exp";
```

### 方法 2: 檢查 API 響應時間

- **1.5 Flash**: 通常 2-5 秒
- **2.0 Flash**: 可能稍快或稍慢（取決於模型版本）

**注意**: 響應時間不是可靠的判斷標準，因為受網路和 prompt 複雜度影響。

### 方法 3: 檢查題目質量

如果題目質量明顯不同，可能是模型切換成功。但這也不是絕對可靠的指標。

**最可靠的方法**: 確認代碼已更新，然後測試功能是否正常。

---

## 📝 測試記錄表

完成測試後，記錄以下信息：

- [ ] API 測試通過
- [ ] 題目生成成功
- [ ] 題目內容正常
- [ ] 無 Console 錯誤
- [ ] 無 Network 錯誤
- [ ] 功能完整性測試通過

**測試時間**: ___________  
**測試人員**: ___________  
**備註**: ___________

---

## 🆘 如果遇到問題

1. **檢查終端日誌**（運行 `npm run dev` 的窗口）
2. **檢查瀏覽器 Console**（F12）
3. **檢查 Network 標籤**（查看 API 請求詳情）
4. **參考完整遷移指南**: `docs/MIGRATION_TO_2.0_FLASH_GUIDE.md`

---

**完成測試後，如果一切正常，就可以提交代碼並部署到 Vercel 了！** 🎉
