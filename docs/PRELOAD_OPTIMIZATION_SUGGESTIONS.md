# é åŠ è¼‰åŠŸèƒ½å„ªåŒ–å»ºè­°

## ğŸ¯ ç•¶å‰å¯¦ç¾

### åŠŸèƒ½æ¦‚è¿°
- âœ… é åŠ è¼‰ï¼ˆå·è·‘ç”Ÿæˆï¼‰åŠŸèƒ½å·²é‡æ–°å•Ÿç”¨
- âœ… é€Ÿç‡é™åˆ¶å·²å„ªåŒ–ï¼Œæ ¹æ“š RPM å‹•æ…‹è¨ˆç®—é–“éš”
- âœ… é åŠ è¼‰æœƒéµå®ˆ RPM é™åˆ¶ï¼Œä¸æœƒè¶…é API é…é¡

### å·¥ä½œæµç¨‹
```
ç”¨æˆ¶åšç¬¬ 1 é¡Œ
  â†“
èƒŒæ™¯è‡ªå‹•ç”Ÿæˆç¬¬ 2 é¡Œï¼ˆé åŠ è¼‰ï¼‰
  â†“
ç”¨æˆ¶é»æ“Šã€Œä¸‹ä¸€é¡Œã€
  â†“
ç›´æ¥ä½¿ç”¨é åŠ è¼‰çš„é¡Œç›®ï¼ˆç„¡éœ€ç­‰å¾…ï¼‰
  â†“
èƒŒæ™¯è‡ªå‹•ç”Ÿæˆç¬¬ 3 é¡Œï¼ˆé åŠ è¼‰ï¼‰
  â†“
å¾ªç’°...
```

---

## ğŸ’¡ å„ªåŒ–å»ºè­°

### 1. æ™ºèƒ½é åŠ è¼‰ç­–ç•¥

#### ç•¶å‰å¯¦ç¾
- å›ºå®šå»¶é²å¾Œé åŠ è¼‰ï¼ˆé–“éš”æ™‚é–“ + 1ç§’ï¼‰

#### å„ªåŒ–å»ºè­°
```javascript
// æ ¹æ“šç”¨æˆ¶ç­”é¡Œé€Ÿåº¦å‹•æ…‹èª¿æ•´é åŠ è¼‰æ™‚æ©Ÿ
const getUserAnswerSpeed = () => {
  // è¨ˆç®—å¹³å‡ç­”é¡Œæ™‚é–“
  // å¦‚æœç”¨æˆ¶ç­”é¡Œå¿«ï¼Œæå‰é åŠ è¼‰
  // å¦‚æœç”¨æˆ¶ç­”é¡Œæ…¢ï¼Œå»¶é²é åŠ è¼‰
};

// æ ¹æ“šç­”é¡Œé€Ÿåº¦èª¿æ•´é åŠ è¼‰å»¶é²
const preloadDelay = getUserAnswerSpeed() < 10 ? 
  MIN_REQUEST_INTERVAL_MS : 
  MIN_REQUEST_INTERVAL_MS + 2000;
```

**å„ªé»**ï¼š
- æ¸›å°‘ä¸å¿…è¦çš„ API èª¿ç”¨
- ç¯€çœé…é¡
- æå‡ç”¨æˆ¶é«”é©—

---

### 2. é åŠ è¼‰å¤±æ•—é‡è©¦æ©Ÿåˆ¶

#### ç•¶å‰å¯¦ç¾
- é åŠ è¼‰å¤±æ•—æ™‚ï¼Œç”¨æˆ¶é»æ“Šã€Œä¸‹ä¸€é¡Œã€æ‰ç”Ÿæˆ

#### å„ªåŒ–å»ºè­°
```javascript
const preloadNextQuestion = async (selectedTopicIds, retryCount = 0) => {
  try {
    // é åŠ è¼‰é‚è¼¯
  } catch (e) {
    if (retryCount < 3 && e.message.includes('quota')) {
      // é…é¡éŒ¯èª¤ï¼Œç­‰å¾…å¾Œé‡è©¦
      await new Promise(resolve => setTimeout(resolve, 60000));
      return preloadNextQuestion(selectedTopicIds, retryCount + 1);
    }
    // å…¶ä»–éŒ¯èª¤ï¼Œè¨˜éŒ„ä½†ä¸é‡è©¦
    console.error("Preload failed:", e);
  }
};
```

**å„ªé»**ï¼š
- æé«˜é åŠ è¼‰æˆåŠŸç‡
- æ¸›å°‘ç”¨æˆ¶ç­‰å¾…æ™‚é–“

---

### 3. é åŠ è¼‰éšŠåˆ—ç®¡ç†

#### ç•¶å‰å¯¦ç¾
- æ¯æ¬¡åªé åŠ è¼‰ä¸€é¡Œ

#### å„ªåŒ–å»ºè­°
```javascript
// ç¶­è­·é åŠ è¼‰éšŠåˆ—
const preloadQueue = [];

// å¦‚æœ RPM å…è¨±ï¼Œé åŠ è¼‰å¤šé¡Œ
if (RPM_LIMIT >= 2000) {
  // æ­£å¼ç’°å¢ƒï¼šå¯ä»¥é åŠ è¼‰ 2-3 é¡Œ
  preloadQueue.push(preloadNextQuestion());
  preloadQueue.push(preloadNextQuestion());
}
```

**å„ªé»**ï¼š
- æ­£å¼ç’°å¢ƒå¯ä»¥é åŠ è¼‰å¤šé¡Œ
- é€²ä¸€æ­¥æ¸›å°‘ç­‰å¾…æ™‚é–“

---

### 4. é åŠ è¼‰å„ªå…ˆç´š

#### å„ªåŒ–å»ºè­°
```javascript
// æ ¹æ“šç”¨æˆ¶è¡Œç‚ºæ±ºå®šæ˜¯å¦é åŠ è¼‰
const shouldPreload = () => {
  // å¦‚æœç”¨æˆ¶æ­£åœ¨ç­”é¡Œï¼Œé åŠ è¼‰
  if (currentQuestion && !userAnswer) return true;
  
  // å¦‚æœç”¨æˆ¶å·²ç­”é¡Œä½†æœªæäº¤ï¼Œä¸é åŠ è¼‰ï¼ˆå¯èƒ½è·³éï¼‰
  if (userAnswer && !feedback) return false;
  
  // å¦‚æœç”¨æˆ¶å·²æäº¤ç­”æ¡ˆï¼Œé åŠ è¼‰
  if (feedback) return true;
  
  return false;
};
```

**å„ªé»**ï¼š
- æ¸›å°‘ä¸å¿…è¦çš„é åŠ è¼‰
- ç¯€çœé…é¡

---

### 5. é åŠ è¼‰ç·©å­˜æ©Ÿåˆ¶

#### å„ªåŒ–å»ºè­°
```javascript
// ç·©å­˜é åŠ è¼‰çš„é¡Œç›®
const preloadCache = new Map();

// å¦‚æœé åŠ è¼‰çš„é¡Œç›®æœªè¢«ä½¿ç”¨ï¼Œä¿ç•™åœ¨ç·©å­˜ä¸­
// ç”¨æˆ¶åˆ‡æ›å–®å…ƒæ™‚ï¼Œå¯ä»¥ä½¿ç”¨ç·©å­˜çš„é¡Œç›®
```

**å„ªé»**ï¼š
- æ¸›å°‘é‡è¤‡ç”Ÿæˆ
- ç¯€çœé…é¡
- æå‡åˆ‡æ›é€Ÿåº¦

---

### 6. é åŠ è¼‰ç‹€æ…‹æŒ‡ç¤º

#### å„ªåŒ–å»ºè­°
```javascript
// é¡¯ç¤ºé åŠ è¼‰ç‹€æ…‹
const [preloadStatus, setPreloadStatus] = useState('idle'); // idle, loading, ready, failed

// åœ¨ UI ä¸­é¡¯ç¤ºé åŠ è¼‰ç‹€æ…‹
{preloadStatus === 'loading' && (
  <div className="text-xs text-gray-500">æ­£åœ¨æº–å‚™ä¸‹ä¸€é¡Œ...</div>
)}
{preloadStatus === 'ready' && (
  <div className="text-xs text-green-500">âœ“ ä¸‹ä¸€é¡Œå·²æº–å‚™</div>
)}
```

**å„ªé»**ï¼š
- ç”¨æˆ¶äº†è§£ç³»çµ±ç‹€æ…‹
- æå‡ç”¨æˆ¶é«”é©—

---

### 7. é åŠ è¼‰éŒ¯èª¤è™•ç†

#### å„ªåŒ–å»ºè­°
```javascript
const preloadNextQuestion = async (selectedTopicIds) => {
  try {
    // é åŠ è¼‰é‚è¼¯
  } catch (e) {
    // åˆ†é¡éŒ¯èª¤
    if (e.message.includes('quota')) {
      // é…é¡éŒ¯èª¤ï¼šåœæ­¢é åŠ è¼‰ï¼Œç­‰å¾…ç”¨æˆ¶æ“ä½œ
      setQuotaExceeded(true);
      return;
    } else if (e.message.includes('network')) {
      // ç¶²è·¯éŒ¯èª¤ï¼šç¨å¾Œé‡è©¦
      setTimeout(() => preloadNextQuestion(selectedTopicIds), 5000);
      return;
    } else {
      // å…¶ä»–éŒ¯èª¤ï¼šè¨˜éŒ„ä½†ä¸å½±éŸ¿ç”¨æˆ¶é«”é©—
      console.error("Preload error:", e);
      return;
    }
  }
};
```

**å„ªé»**ï¼š
- æ›´å¥½çš„éŒ¯èª¤è™•ç†
- æå‡ç³»çµ±ç©©å®šæ€§

---

## ğŸ“Š æ€§èƒ½å°æ¯”

### æ¸¬è©¦ç’°å¢ƒï¼ˆRPM 15ï¼‰

| æ–¹æ¡ˆ | é åŠ è¼‰å»¶é² | ç”¨æˆ¶ç­‰å¾…æ™‚é–“ | é…é¡ä½¿ç”¨ |
|------|-----------|------------|---------|
| **ç•¶å‰å¯¦ç¾** | 4.4ç§’ | 0ç§’ï¼ˆé åŠ è¼‰æˆåŠŸï¼‰ | æ­£å¸¸ |
| **å„ªåŒ–å¾Œ** | å‹•æ…‹èª¿æ•´ | 0ç§’ï¼ˆé åŠ è¼‰æˆåŠŸï¼‰ | æ¸›å°‘ 20-30% |

### æ­£å¼ç’°å¢ƒï¼ˆRPM 2000ï¼‰

| æ–¹æ¡ˆ | é åŠ è¼‰å»¶é² | ç”¨æˆ¶ç­‰å¾…æ™‚é–“ | é…é¡ä½¿ç”¨ |
|------|-----------|------------|---------|
| **ç•¶å‰å¯¦ç¾** | 33ms | 0ç§’ï¼ˆé åŠ è¼‰æˆåŠŸï¼‰ | æ­£å¸¸ |
| **å„ªåŒ–å¾Œ** | å‹•æ…‹èª¿æ•´ | 0ç§’ï¼ˆé åŠ è¼‰æˆåŠŸï¼‰ | æ¸›å°‘ 10-15% |

---

## ğŸ¯ å¯¦æ–½å„ªå…ˆç´š

### é«˜å„ªå…ˆç´šï¼ˆç«‹å³å¯¦æ–½ï¼‰
1. âœ… **é åŠ è¼‰åŠŸèƒ½é‡æ–°å•Ÿç”¨** - å·²å®Œæˆ
2. âœ… **RPM é™åˆ¶æ©Ÿåˆ¶** - å·²å®Œæˆ
3. âš ï¸ **é åŠ è¼‰å¤±æ•—é‡è©¦æ©Ÿåˆ¶** - å»ºè­°å¯¦æ–½

### ä¸­å„ªå…ˆç´šï¼ˆçŸ­æœŸå¯¦æ–½ï¼‰
4. **æ™ºèƒ½é åŠ è¼‰ç­–ç•¥** - æ ¹æ“šç”¨æˆ¶è¡Œç‚ºèª¿æ•´
5. **é åŠ è¼‰ç‹€æ…‹æŒ‡ç¤º** - æå‡ç”¨æˆ¶é«”é©—

### ä½å„ªå…ˆç´šï¼ˆé•·æœŸå„ªåŒ–ï¼‰
6. **é åŠ è¼‰éšŠåˆ—ç®¡ç†** - æ­£å¼ç’°å¢ƒå„ªåŒ–
7. **é åŠ è¼‰ç·©å­˜æ©Ÿåˆ¶** - é€²ä¸€æ­¥å„ªåŒ–

---

## ğŸ“ å¯¦æ–½å»ºè­°

### éšæ®µ 1ï¼šåŸºç¤å„ªåŒ–ï¼ˆç•¶å‰ï¼‰
- âœ… é‡æ–°å•Ÿç”¨é åŠ è¼‰åŠŸèƒ½
- âœ… å¯¦æ–½ RPM é™åˆ¶æ©Ÿåˆ¶
- âœ… æ·»åŠ é…ç½®æé†’

### éšæ®µ 2ï¼šéŒ¯èª¤è™•ç†å„ªåŒ–ï¼ˆå»ºè­°ï¼‰
- å¯¦æ–½é åŠ è¼‰å¤±æ•—é‡è©¦æ©Ÿåˆ¶
- æ”¹é€²éŒ¯èª¤åˆ†é¡å’Œè™•ç†
- æ·»åŠ é åŠ è¼‰ç‹€æ…‹æŒ‡ç¤º

### éšæ®µ 3ï¼šæ™ºèƒ½å„ªåŒ–ï¼ˆæœªä¾†ï¼‰
- å¯¦æ–½æ™ºèƒ½é åŠ è¼‰ç­–ç•¥
- æ·»åŠ é åŠ è¼‰ç·©å­˜æ©Ÿåˆ¶
- å„ªåŒ–é åŠ è¼‰éšŠåˆ—ç®¡ç†

---

## ğŸ” ç›£æ§æŒ‡æ¨™

### å»ºè­°ç›£æ§çš„æŒ‡æ¨™
1. **é åŠ è¼‰æˆåŠŸç‡**ï¼šé åŠ è¼‰æˆåŠŸ / ç¸½é åŠ è¼‰æ¬¡æ•¸
2. **é åŠ è¼‰å‘½ä¸­ç‡**ï¼šä½¿ç”¨é åŠ è¼‰é¡Œç›® / ç¸½é¡Œç›®æ•¸
3. **å¹³å‡ç­‰å¾…æ™‚é–“**ï¼šç”¨æˆ¶é»æ“Šã€Œä¸‹ä¸€é¡Œã€åˆ°é¡¯ç¤ºé¡Œç›®çš„æ™‚é–“
4. **é…é¡ä½¿ç”¨æ•ˆç‡**ï¼šæœ‰æ•ˆè«‹æ±‚ / ç¸½è«‹æ±‚æ•¸

### ç›®æ¨™å€¼
- é åŠ è¼‰æˆåŠŸç‡ï¼š> 90%
- é åŠ è¼‰å‘½ä¸­ç‡ï¼š> 80%
- å¹³å‡ç­‰å¾…æ™‚é–“ï¼š< 100ms
- é…é¡ä½¿ç”¨æ•ˆç‡ï¼š> 85%

---

## ğŸ“š ç›¸é—œæ–‡æª”

- `docs/RPM_LIMIT_CONFIGURATION.md` - RPM é…ç½®æŒ‡å—
- `app/lib/constants.js` - é…ç½®æ–‡ä»¶
- `app/page.tsx` - é åŠ è¼‰å¯¦ç¾

---

**æœ€å¾Œæ›´æ–°**ï¼š2024å¹´12æœˆ
