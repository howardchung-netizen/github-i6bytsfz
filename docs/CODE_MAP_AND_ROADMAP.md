# AI Math Tutor - Code Map & 開發路線圖

## 📊 當前項目結構

```
github-i6bytsfz/
├── app/
│   ├── api/                          # API 路由層
│   │   ├── chat/                     # ✅ AI 題目生成
│   │   ├── check-env/                # ✅ 環境檢查
│   │   ├── check-quota/              # ✅ 配額檢查
│   │   ├── payment/                  # ✅ Stripe 支付（待配置）
│   │   ├── test-google-api/          # ✅ API 測試
│   │   ├── vision/                   # ⚠️ 圖像識別（未使用）
│   │   └── webhooks/stripe/          # ✅ Stripe Webhook
│   │
│   ├── components/                   # UI 組件層
│   │   ├── DashboardView.tsx         # ✅ 學生儀表板
│   │   ├── PracticeView.tsx          # ✅ 練習視圖
│   │   ├── RegisterView.tsx          # ✅ 註冊/登入
│   │   ├── SubscriptionView.tsx      # ✅ 訂閱頁面
│   │   ├── DailyTaskView.tsx         # ✅ 每日任務
│   │   ├── CommonViews.tsx           # ✅ 通用視圖（錯題本、選擇等）
│   │   ├── ParentView.tsx            # ⚠️ 家長視圖（基礎版）
│   │   ├── TeacherView.tsx           # ⚠️ 教師視圖（基礎版）
│   │   ├── DeveloperView.tsx         # ✅ 開發者工具（數學）
│   │   ├── ChineseDeveloperView.tsx  # ✅ 開發者工具（中文）
│   │   └── EnglishDeveloperView.tsx  # ✅ 開發者工具（英文）
│   │
│   ├── lib/                          # 核心服務層
│   │   ├── ai-service.js             # ✅ AI 服務（題目生成）
│   │   ├── db-service.js             # ✅ 數據庫服務
│   │   ├── firebase.js               # ✅ Firebase 配置
│   │   ├── constants.js              # ✅ 常量定義
│   │   ├── adhd-utils.js             # ⚠️ ADHD 工具（基礎）
│   │   ├── rag-service.js            # ⚠️ RAG 服務（未使用）
│   │   └── mock-data-generator.js    # ✅ 模擬數據生成
│   │
│   ├── subscription/success/         # ✅ 支付成功頁面
│   ├── page.tsx                      # ✅ 主應用入口
│   └── layout.tsx                    # ✅ 應用佈局
│
└── docs/                             # 文檔
    ├── TODO_STRIPE_SETUP.md          # ✅ Stripe 設置指南
    ├── API_QUOTA_TRACKING.md         # ✅ API 配額追蹤
    └── ...                            # 其他文檔
```

---

## ✅ 已完成功能（綠色）

### 核心功能
- [x] **用戶認證系統**
  - Firebase Auth 整合
  - 註冊/登入/登出
  - 匿名登入支持

- [x] **AI 題目生成**
  - Google Gemini API 整合
  - 文字題生成
  - 選擇題生成（數學 8 選項，其他 4 選項）
  - 種子題目變體生成

- [x] **練習系統**
  - 題目選擇界面
  - 練習視圖
  - 答題檢查
  - 錯題本功能
  - 每日任務限制（每科 20 題）

- [x] **數據管理**
  - Firebase Firestore 整合
  - 用戶資料管理
  - 錯題記錄
  - 學習歷程記錄

- [x] **基礎 UI**
  - 儀表板
  - 能力雷達圖
  - ADHD 模式開關（基礎）
  - 響應式設計

- [x] **開發者工具**
  - 單元管理
  - 種子題上傳
  - AI 生成測試

- [x] **部署**
  - Vercel 部署完成
  - 環境變數配置
  - 生產環境運行

---

## ⚠️ 部分完成功能（黃色）

### 需要完善的功能
- [ ] **家長視圖** (`ParentView.tsx`)
  - ✅ 基礎 UI 已建立
  - ❌ 數據統計不完整
  - ❌ 缺少詳細報告
  - ❌ 缺少時間趨勢分析

- [ ] **教師視圖** (`TeacherView.tsx`)
  - ✅ 基礎 UI 已建立
  - ✅ 班級管理（部分）
  - ❌ 派卷功能不完整
  - ❌ 數據分析不完整

- [ ] **ADHD 模式**
  - ✅ 基礎 UI 切換
  - ❌ 關鍵字高亮未實現
  - ❌ 語音讀題未實現
  - ❌ 專注力報告未實現

- [ ] **支付系統**
  - ✅ Stripe 代碼完成
  - ✅ Webhook 處理完成
  - ❌ 等待公司成立後配置
  - ❌ 訂閱權限鎖定未實現

---

## ❌ 待開發功能（紅色）

### 高優先級
1. **AI 雙週報告生成器**
   - 訂閱用戶核心功能
   - 自動生成進度報告
   - 客製化課程建議

2. **訂閱權限鎖定**
   - 免費用戶限制實施
   - 訂閱功能解鎖
   - 功能訪問控制

3. **家長視圖完整化**
   - 詳細數據統計
   - 學習時間分析
   - 成績趨勢圖表
   - AI 評語展示

4. **教師視圖完整化**
   - 完整班級管理
   - 派卷功能完善
   - 學生進度追蹤
   - 數據中控台

### 中優先級
5. **ADHD 模式深度優化**
   - 關鍵字高亮算法
   - TTS 語音合成
   - 專注力報告生成
   - 可匯出報告

6. **數據統計增強**
   - 更詳細的能力分析
   - 學習路徑建議
   - 弱項強化建議

7. **錯題本增強**
   - 舉一反三功能完善
   - 錯題分類
   - 錯題複習計劃

### 低優先級
8. **性能優化**
   - 緩存機制
   - 圖片優化
   - 代碼分割

9. **用戶體驗優化**
   - 動畫效果
   - 載入狀態優化
   - 錯誤處理完善

---

## 🗺️ 開發路線圖（建議順序）

### Phase 1: 核心功能完善（1-2 週）
**目標：讓基本功能完整可用**

1. **訂閱權限鎖定** ⭐⭐⭐
   - 實現免費/訂閱用戶功能差異
   - 添加功能訪問控制
   - 測試權限系統

2. **家長視圖完整化** ⭐⭐⭐
   - 完善數據統計
   - 添加趨勢圖表
   - 實現 AI 評語展示

3. **教師視圖完整化** ⭐⭐
   - 完善班級管理
   - 實現派卷功能
   - 添加數據分析

### Phase 2: 高級功能（2-3 週）
**目標：實現訂閱用戶核心價值**

4. **AI 雙週報告生成器** ⭐⭐⭐
   - 設計報告模板
   - 實現 AI 生成邏輯
   - 添加報告查看界面

5. **ADHD 模式深度優化** ⭐⭐
   - 實現關鍵字高亮
   - 整合 TTS 語音
   - 生成專注力報告

### Phase 3: 優化與增強（1-2 週）
**目標：提升用戶體驗**

6. **錯題本增強**
   - 完善舉一反三功能
   - 添加錯題分類

7. **性能優化**
   - 實現緩存機制
   - 優化載入速度

8. **用戶體驗優化**
   - 添加動畫效果
   - 完善錯誤處理

---

## 📋 下一步具體任務（建議從這裡開始）

### 任務 1: 訂閱權限鎖定 ⭐⭐⭐
**優先級：最高**
**預估時間：2-3 天**

**需要修改的文件：**
- `app/page.tsx` - 添加權限檢查邏輯
- `app/components/DashboardView.tsx` - 根據權限顯示/隱藏功能
- `app/components/PracticeView.tsx` - 限制免費用戶功能
- `app/lib/db-service.js` - 添加權限檢查函數

**具體工作：**
1. 實現 `checkUserPermission()` 函數
2. 在關鍵功能點添加權限檢查
3. 添加「升級到訂閱版」提示
4. 測試免費/訂閱用戶體驗差異

---

### 任務 2: 家長視圖完整化 ⭐⭐⭐
**優先級：高**
**預估時間：3-4 天**

**需要修改的文件：**
- `app/components/ParentView.tsx` - 完善數據展示
- `app/lib/db-service.js` - 添加數據統計函數
- `app/lib/ai-service.js` - 添加 AI 評語生成

**具體工作：**
1. 實現學習時間統計
2. 添加成績趨勢圖表（使用 Recharts）
3. 實現 AI 評語生成和展示
4. 添加數據篩選功能（按日期、科目）

---

### 任務 3: AI 雙週報告生成器 ⭐⭐⭐
**優先級：高**
**預估時間：4-5 天**

**需要創建的文件：**
- `app/components/ProgressReportView.tsx` - 報告查看界面
- `app/lib/report-generator.js` - 報告生成邏輯
- `app/api/generate-report/route.ts` - 報告生成 API

**具體工作：**
1. 設計報告模板結構
2. 實現數據收集邏輯（過去 2 週）
3. 實現 AI 生成報告內容
4. 創建報告查看界面
5. 添加報告歷史記錄

---

### 任務 4: ADHD 模式深度優化 ⭐⭐
**優先級：中**
**預估時間：3-4 天**

**需要修改的文件：**
- `app/lib/adhd-utils.js` - 實現關鍵字高亮
- `app/components/PracticeView.tsx` - 整合 ADHD 功能
- `app/lib/tts-service.js` - 創建 TTS 服務（新文件）

**具體工作：**
1. 實現關鍵字識別和高亮算法
2. 整合 Web Speech API 或第三方 TTS
3. 實現專注力報告生成
4. 添加報告匯出功能

---

## 🎯 建議的開發順序

### 本週（等待 API 配額重置期間）
1. ✅ **訂閱權限鎖定** - 這是基礎，必須先完成
2. ✅ **家長視圖完整化** - 提升用戶價值

### 下週（API 配額恢復後）
3. ✅ **AI 雙週報告生成器** - 訂閱用戶核心功能
4. ✅ **教師視圖完整化** - 完善教學者功能

### 之後
5. ✅ **ADHD 模式深度優化** - 增強特殊需求支持
6. ✅ **性能優化** - 提升整體體驗

---

## 📝 開發注意事項

### 代碼規範
- 保持 TypeScript 類型安全
- 遵循現有的代碼風格
- 使用 Tailwind CSS 保持 UI 一致性

### 測試要求
- 每個新功能都要測試免費/訂閱用戶差異
- 測試 ADHD 模式開關
- 測試響應式設計

### 性能考慮
- AI 功能超過 3 秒需實現預加載
- 避免不必要的 API 調用
- 實現適當的緩存機制

---

## 🔗 相關文檔

- `app/project_context.md` - 項目完整背景
- `docs/TODO_STRIPE_SETUP.md` - Stripe 設置指南
- `docs/API_QUOTA_TRACKING.md` - API 配額追蹤
- `docs/HONG_KONG_DEPLOYMENT_GUIDE.md` - 部署指南

---

**最後更新**: 2024-01-XX
**當前版本**: v2.0 Stable
**下一步**: 訂閱權限鎖定
